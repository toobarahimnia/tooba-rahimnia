<!DOCTYPE html>
<html lang="en">
    <head><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>DevJane Portfolio Website</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" integrity="sha256-46qynGAkLSFpVbEBog43gvNhfrOj+BmwXdxFgVK/Kvc=" crossorigin="anonymous" />  
        
        <!-- Update these with your own fonts -->
        <link href="https://fonts.googleapis.com/css?family=Lora:400,700|Roboto+Slab:400,700&display=swap" rel="stylesheet"> 
        
        <link rel="stylesheet" href="css/style.css">

    </head>
        
        
    <body> 
        <!-- sidebar -->
        <div class="sidebar">
            <div><a href="project_8.html#header1"><h4>Stable Fluid - Jos Stam (2D)</h4></a></div>
        
            <div><a href="project_8.html#header2"><h5>Background</h5></a></div>
                <div><a href="project_8.html#header3"><h6>Vector Field</h6></a></div>
                <div><a href="project_8.html#header4"><h6>Divergence</h6></a></div>

            <div><a href="project_8.html#header5"><h5>Introduction</h5></a></div>
                <div><a href="project_8.html#header6"><h6>Conservation of mass</h6></a></div>
                <div><a href="project_8.html#header7"><h6>Conservation of Momentum</h6></a></div>

            <div><a href="project_8.html#header8"><h5>Navier Stokes Equations</h5></a></div>
                <div><a href="project_8.html#header9"><h6>Pressure Gradient</h6></a></div>
                <div><a href="project_8.html#header10"><h6>Viscosity</h6></a></div>
                <div><a href="project_8.html#header11"><h6>Free-Body Diagram</h6></a></div>
                <div><a href="project_8.html#header12"><h6>Naming Convention</h6></a></div>

            <div><a href="project_8.html#header13"><h5>Helmholtz-Hodge Theorm</h5></a></div>
            <div><a href="project_8.html#header14"><h5>Implementation</h5></a></div>
                


            <div><a href="project_8.html#header15"><h5>Result</h5></a></div>

        </div>
        <header>
            <button class="nav-toggle" aria-label="toggle navigation">
                <span class="hamburger"></span>
            </button>
            <nav class="nav">
                <ul class="nav__list">
                    <li class="nav__item"><a href="index.html" class="nav__link">Home</a></li>
                    <li class="nav__item"><a href="index.html#about_me" class="nav__link">About me</a></li>
                    <li class="nav__item"><a href="index.html#my_working" class="nav__link">Work experience</a></li>
                    <li class="nav__item"><a href="index.html#projects" class="nav__link">Projects</a></li>
                </ul>
            </nav>
        </header>
        
          

        <section class="intro">            
            <h1 class="section__title section__title--intro">
                <font size="7rem">Physics-Based Deep Learning (Smoke Simulation)</font>
            </h1>
            <p class="section__subtitle section__subtitle--intro">Project</p>
            <img src="img/smoke_sim.png" alt="" class="intro__img">
        </section>
        
        
        
        
        <div class="portfolio-item-individual"> 
            <p>Use PC for better user interface experience.</p>
            
            <p><Strong><font size="6rem"><a id="header1">Stable Fluids - Jos Stam (2D version)</a></font></strong></p>
            
            <p> Fluid simulation contains computer graphics techniques for generating realistic fluid animations such as water and smoke. In this project, we attempt to simulate a basic smoke model following the grid-based method described by Jose Stam in the <a href="https://d2f99xq7vri1nk.cloudfront.net/legacy_app_files/pdf/ns.pdf" target="_blank">‚ÄúStable Fluids‚Äù</a> paper.</p>
            
            <p><Strong><font size="5rem"><a id="header2">Background</a></font></strong></p>
            
            <p><Strong><font size="4rem"><a id="header3">Vector Field</a></font></strong></p>
            
            <p>The velocity vector field of fluid (v‚Éó) is defined such that for every position x = (x, y), there is an associated velocity at time t: <br>U(x, t) = u(x, t), v(x, t), w(x, t).<p>

            <p>We can think of this as a (multivariable) vector-valued function, whose input is a point (x,y), and the output is a vector with the same dimension as input.</p>
	
            <p>The key to fluid simulation is to take steps in time and, at each time step, correctly determine the current velocity field. We will later see this done by solving a set of equations that describes the evolution of the velocity field over time, under a variety of forces.</p>
            
            <p><Strong><font size="4rem"><a id="header4">Divergence</a></font></strong></p>
            
            <p>The divergence is an operator, which takes in the vector-valued function defining this vector field, and outputs a scalar-valued function measuring the change in density of the fluid at each point.</p>
            
           
            <img src="img/formula_div1.png" alt="Snow" style="width:30%" class="center">
           
            
            <p>Divergence can become negative, positive or zero. Negative divergence means a fluid flowing along the vector field defined by v‚Éó would tend to become more dense at the point (x0 ,y0). Positive divergence means the fluid flowing along vector field becomes more sparse at a certain point. And finally, zero-divergence indicates that even though a fluid flows freely, its density (the degree of compactness of a substance) stays constant. </p>
            
            <img src="img/formula_div2.png" alt="Snow" style="width:40%" class="center">
                        
            <p><Strong><font size="5rem"><a id="header5">Introduction</a></font></strong></p>
            
            <p>Physics of fluid is governed by two fundamental principles, namely mass conservation, and momentum conservation. We use these principles to derive the Navier-stokes equation, that is the heart of all equations needed for fluid simulation here.</p>
            
            
            <p><Strong><font size="4rem"><a id="header6">Conservation of mass</a></font></strong></p>
            
            <p>Continuity equation: The mass in the control volume can neither be created nor destroyed.</p>
            
            <img src="img/formula_cons_mass.png" alt="Snow" style="width:40%" class="center">
            
            <p>&rho; (rho) is the mas density [kg/m<sup>3</sup>].</p>
            
            <p><Strong><font size="4rem"><a id="header7">Conservation of Momentum</a></font></strong></p>
            
            <p>Newton‚Äôs second law: In a closed system, one that does not exchange any matter with its surroundings and is not acted on by external forces, the total momentum remains constant.</p>

            <img src="img/formula_cons_momen.png" alt="Snow" style="width:40%" class="center">
            
            <p>ùëì_ùëèùëúùëëùë¶ is the applied gravitational force on the whole mass of fluid. The force applied per unit volume (force density) is then equal to the mass density (&rho;) times the acceleration due to gravity: f = œÅg</p>

            <p>ùëì_ùë†ùë¢ùëüùëìùëéùëêùëí is expressed through pressure and viscous forces (which we will go into details soon).</p>

            <br>
            <br>
            
            <p><Strong><font size="5rem"><a id="header8">Navier Stokes Equations</a></font></strong></p>
            
            <p> First thing first, we need to derive Navier-Stokes (momentum) equation for fluids based off of the following assumptions:</P>
            <p>
                <ul style="float: right; margin-right: 61%;">
                <li>Newtonian Fluid</li>
                <li>Incompressible</li>
                <li>Isothermal</li>
                </ul>
            </p> 
            
            <p>Given a 3 dimensional space, fluids are subject to forces from all 3 directions. Here, we only consider the X-components of velocity of the fluid. Similar approach can be applied to get the results for Y and Z directions.</p>
            
            <p>To find the acceleration of fluid in move, we use the famous formula <br>F = ma:</p>
            <img src="img/formula_NS1.png" alt="Snow" style="width:50%" class="center">

            
            <p>As discussed in the <a href="project_8.html#header7">conservation of momentum</a> section, there are 3 forces to be considered (per volume basis):</p>
            <p>
                <ul style="float: right; margin-right: 40%;">
                <li>Gravity (ùëì_ùëèùëúùëëùë¶, external)</li>
                <li>Pressure difference (ùëì_ùë†ùë¢ùëüùëìùëéùëêùëí, internal)</li>
                <li>Viscous (ùëì_ùë†ùë¢ùëüùëìùëéùëêùëí, internal)</li>
                </ul>
            </p> 

            <p>The force exerted by gravity is self-explanatory. Now let's move to the internal forces due to Pressure and viscosity.</p>
            
            <p><Strong><font size="3rem"><a id="header9">Pressure Gradient</a></font></strong></p>
            
            <p>Fluid pressure is a measurement of the force per unit area. Fluid pressure can be caused by gravity, acceleration, or forces in a closed container. Since a fluid has no definite shape, its pressure applies in all directions. The net force due to pressure in the x-direction is given by:</p>
            
            <img src="img/pressure_fig.png" alt="Snow" style="width:50%" class="center">

            <p>As you can see from the above figure, the pressure forces are acting on the front and back surface of the cubic volume element (along the x-axis), because the forces due to pressure are always exerted perpendicular to any surface (and we are only considering the x-axis here).</p>
            
            <p>These pressure forces basically represent normal stresses and are therefore denoted by the Greek symbol œÉ instead of p. In addition to the pressure forces, we are going to see that viscosity-related forces can also act perpendicular to the surfaces and contribute to normal stress.</p>
                
            <p>In a similar manner, net forces acting in y‚Äê and z‚Äêdirections can be calculated. The total net force vector, due to pressure then is:</p>
            
            <img src="img/total_pressure_fig.png" alt="Snow" style="width:40%" class="center">
            
            <p>The term in the parentheses is the negative vector gradient of pressure and dx dy dz = dV, is the volume of the element. Therefore, one can write:</p>

            <img src="img/total_pressure2_fig.png" alt="Snow" style="width:20%" class="center">
            
            <p><font size="2rem">**Note: When the fluid is at rest, pressure gradient must be balanced by gravity force. When at move, it should be balanced by gravity, viscosity and other effects in the fluid.</font></p>
            
            
            <p><Strong><font size="3rem"><a id="header10">Viscosity</a></font></strong></p>
            
            <p>Viscous force is a measure of a fluid's resistance to flow. In many fluids, the flow velocity is observed to vary linearly from zero at the bottom to u at the top. Moreover, the magnitude of the force, F, acting on the top plate is found to be proportional to the speed u and the area A of each plate, and inversely proportional to their separation height h:</p>
            
            <img src="img/viscous1.png" alt="Snow" style="width:50%" class="center">

            <img src="img/viscous2.png" alt="Snow" style="width:15%" class="center">

            
            <p>The proportionality factor is the dynamic viscosity of the fluid, often simply referred to as the viscosity. It is denoted by the Greek letter mu (Œº) with the unit of [N.s/m<sup>2</sup>].</p>
            
            <p>The aforementioned ratio u/h is called the rate of shear deformation or shear velocity, and is the derivative of the fluid speed in the direction perpendicular to the plates. If the velocity does not vary linearly with h, then the appropriate generalization is:</p>
            
            <img src="img/viscous3.png" alt="Snow" style="width:15%" class="center">
            
            <p> &tau; is the shear stress [N/m<sup>2</sup>]. <br>‚àÇu/‚àÇy is the local shear velocity [m/s/m]. 
            
            
            <p><br><font size="4rem">Viscous Stress Tensor:</font></p>
            
            
            <p>In three-dimensional flow, the velocity or velocity gradient changes in all three directions. Due to the viscosity, the resulting shear stress is no longer only due to the velocity gradient in a certain direction, but also to a velocity gradient perpendicular to it.</p>
            
            <p>This situation is similar to the deformation of a fluid element. Imagine shear forces that deform the fluid element. In this way, inclined surfaces are formed so that the shear forces acting on the surface now affect another spatial dimension. In fact, in fluids, the stresses acting in additional spatial directions are not due to an actual deformation (magnitude of shearing), but to the shear rate.</p>
            
            <p>This insight leads to the introduction of a so-called <em>viscous stress tensor</em>, which describes the stresses (normal and shear stresses) acting on a fluid element:</p>
           
            <p>The stress on a surface pointing in the ‚àíi direction is the negative of the stress on a surface in the +i direction, etc.</p>

            <img src="img/viscous4.png" alt="Snow" style="width:60%" class="center">

            <p>Writing the reference stresses in terms of their components, we obtain:</p>

            <img src="img/viscous5.png" alt="Snow" style="width:30%" class="center">


            <p><a id="vis1">Therefore</a>, the stress <var class="vector">&sigma;<span>&#8407;</span></var> (<var class="vector">n<span>&#8407;</span></var>) acting at <var class="vector">x<span>&#8407;</span></var>, t on a surface with any arbitrary orientation <var class="vector">n<span>&#8407;</span></var> can be expressed in terms of the nine reference stress components:</p>
            
            <img src="img/viscous6.png" alt="Snow" style="width:40%" class="center">
            
            <p>For an isotropic incompressible Newtonian fluid with constant [dynamic] viscosity, the components of the viscous stress tensor œÑ can be determined from the viscosity Œ∑ as follows:</p>
            
            <img src="img/viscous7.png" alt="Snow" style="width:50%" class="center">
            
            <p>The rate of angular (or shear) strain in the fluid particle as seen by an observer sitting on it is:</p>
            
            <img src="img/viscous8.png" alt="Snow" style="width:25%" class="center">
            
            <p>The <a id="vis2">Newtonian assumption</a> requires that:</p>
            
            <img src="img/viscous9.png" alt="Snow" style="width:30%" class="center">
            
            <p>&tau;<sub>xx</sub> , &tau;<sub>yx</sub> and &tau;<sub>zx</sub> represent the x, y, and z components of the stress acting on the surface whose outward normal is oriented in the positive x-direction.</p>
            
            <p>Due to the viscosity Œ∑, shear forces or shear stresses in x-direction act on the lateral surfaces of the fluid element and on the top and bottom surfaces. In contrast to the normal stresses, which are directed perpendicular to the surface, the shear stresses act parallel to the surface.</p>
            
            <p><Strong><font size="3rem"><a id="header11">Free-Body Diagram</a></font></strong></p>
                <img src="img/free_body.png" alt="Snow" style="width:70%" class="center">

                <p>Forces acting on the cross-sectional area of differential element of the fluid (unit: [F/m<sup>2</sup>] or Pascals):</p>
               
                <img src="img/body1.png" alt="Snow" style="width:55%" class="center">

                <p>Equating the applied forces found in the <a href="project_8.html#header9">pressure gradiant</a> and <a href="project_8.html#vis1">viscosity</a> sections (shown in the above diagram), we get:<br></p>
               
                <img src="img/body2.png" alt="Snow" style="width:70%" class="center">
               
                <p>Simplifying right-hand side:</p>
                <img src="img/body3.png" alt="Snow" style="width:60%" class="center">

                <p>Dividing both sides by volume:</p>
                <img src="img/body4.png" alt="Snow" style="width:60%" class="center">

                <p>Re-writing our viscous forces using <a = href="project_8.html#vis2">equation (*)</a>:</p>
                <img src="img/body5.png" alt="Snow" style="width:60%" class="center">
    
                <p>Re-ordering:</p>
                <img src="img/body6.png" alt="Snow" style="width:65%" class="center">
                
                <p>And from the <a href="project_8.html#header8">material derivative expansion</a> we know that the acceleration can be rewritten as follows:</p>
                <img src="img/body7.png" alt="Snow" style="width:55%" class="center">
                
                <p>Factoring out the dynamic viscosity, with the units:</p>
                <img src="img/body8.png" alt="Snow" style="width:60%" class="center">
                
                <p><font size="2rem">**Note: The force density, or force per unit volume, f, is the net force (F) on a region of matter divided by the volume (V) that contains it: f = F/V</font></p>
               
                <p>Final form (all directions: x, y, z):</p>
                <img src="img/body9.png" alt="Snow" style="width:60%" class="center">
                
                <p>Dividing by &rho;:</p>
                <img src="img/body10.png" alt="Snow" style="width:60%" class="center">

               <br>
               <br>
               
               <p><Strong><font size="3rem"><a id="header12">Naming Convention</a></font></strong></p>
               <p>In order to consolidate the namings used in our formulas, we  will stricktly follow the rules given below to represent vaariables:</p>
               <p>
                   scalar       &rarr; lower-case, italic:       <em>a</em><br>
                   scalar field &rarr; upper-case:                   A(x, y, z)<br>
                   vector       &rarr; lower-case, boldface: <strong>a</strong><br>
                   vector field &rarr; upper-case, boldface: <strong>A</strong>
               </p>
               <p>
                  Following is a list of our formulas, written in the format mentioned above. 
               </p>
               <ul style="float: right; margin-right: 30%;">
                    <li>‚àá &dot; <strong>V</strong> = <sup>‚àÇ<strong>v</strong><sub>1</sub></sup>&frasl;<sub>‚àÇx</sub> + <sup>‚àÇ<strong>v</strong><sub>2</sub></sup>&frasl;<sub>‚àÇy</sub> + <sup>‚àÇ<strong>v</strong><sub>3</sub></sup>&frasl;<sub>‚àÇz</sub></li>
                    
                    <br>
                    
                    <li><sup>D&rho;</sup>&frasl;<sub>Dt</sub> + &rho;‚àá &dot; <strong>V</strong> = 0</li>
                    
                    <br>

                    <li>&rho;<sup>D<strong>V</strong></sup>&frasl;<sub>Dt</sub> = &rho;g + ‚àá &dot; <strong>&tau;</strong><sub>ij</sub> = &rho;g - ‚àáP + &mu;‚àá<sup>2</sup><strong>V</strong></li>
                    
                    <br>

                    <li><strong>a<sub>x</sub></strong> = <sup>d<strong>u</strong></sup>&frasl;<sub>dt</sub> = <sup>‚àÇ<strong>u</strong></sup>&frasl;<sub>‚àÇt</sub> + <sup>‚àÇ<strong>u</strong></sup>&frasl;<sub>‚àÇx</sub> u + <sup>‚àÇ<strong>u</strong></sup>&frasl;<sub>‚àÇy</sub>v + <sup>‚àÇ<strong>u</strong></sup>&frasl;<sub>‚àÇz</sub>w</li>
                    
                    <br>

                    <li>f = a (<sup><strong>u</strong></sup>&frasl;<sub>h</sub>) &mu;</li>
                    
                    <br>

                    <li>eq6</li>
                    
                    <br>

                    <li>eq7</li>
                    
                    <br>

                    <li>eq8</li>
                    
                    <br>

                    <li>eq9</li>
                    </ul>
               <br>
               <br>
               <p><Strong><font size="5rem"><a id="header13">Helmholtz-Hodge Decomposition Theorem</a></font></strong></p>
                
               
                <p>From Jos Stam's paper we find that N-S equations are perfect for fluid flow simulation. Given velocity and pressure at t=0, we need to use N-S to find their values at t > 0. N-S equations are supplemented with boundary conditions:</p>
                <p>
                    <ul style="float: right; margin-right: 65%;">
                    <li>Periodic</li>
                    <li>Fixed (used!)</li>
                    </ul>
                </p> 

                <p>Fixed boundary condition: fluid lies in some bounded domain D. Boundary conditions are given by a function u<sub>D</sub> defined on the boundary ‚àÇD of the domain. Condition should be such that the normal component of the velocity field is zero at the boundary, in other words, no matter should traverse wall:  <var class="vector">u<span>&#8407;</span></var> . n&#770; = 0</p>
                
                <p>Helmholtz-Hodge Decomposition Theorem says a vector field w on a region in space, in our case a plane D, can be uniquely decomposed in the form:</p>
                
                <img src="img/HHT1.png" alt="Snow" style="width:20%" class="center">
                
                <p>Where u has zero divergence and is parallel to &#8706;D (boundary of the region); that is, <var class="vector">u<span>&#8407;</span></var> . n&#770; = 0 on &#8706;D. P is a scalar field.</p>
                
                <p>Any vector field is the sum of a mass conserving field and a gradient field. This result allows us to define an operator P which projects any vector field w onto its divergence free part u = Pu . Multiplying both sides of the equation above by ‚Äú‚àá‚Äù:</p>
                
                <img src="img/HHT2.png" alt="Snow" style="width:40%" class="center">
                
                <p> But since &Delta; . u = 0, this simplifies to ‚àá<sup>2</sup>p = ‚àá . w (poisson equation).</p>
                <p> A solution to this equation is used to compute the projection u:</p>
                
                <img src="img/HHT3.png" alt="Snow" style="width:20%" class="center">
                
                <p>Applying the same projection operator to the Navier-Stokes equations:</p>
                <img src="img/HHT4.png" alt="Snow" style="width:40%" class="center">

                <p>Because u is divergence-free, so is the derivative on the left-hand side, so P(&#8706;u / &#8706;t) = &#8706;u / &#8706;t.</p>
                
                <img src="img/HHT5.png" alt="Snow" style="width:40%" class="center">
                
                <p> Where we use the fact that Pu = u and P‚àáp = 0.</p>
                
                <p><font size="2rem">**Note on p (pressure): We can shrink the size of our "container" down to an infinitely small point, and the pressure has a single value at that point. Which means pressure is a scalar quantity, not a vector quantity. It has a magnitude but no direction associated with it. Pressure acts in all directions at a point inside a gas.</font></p>

                <p><Strong><font size="5rem"><a id="header14">Implementation</a></font></strong></p>
                
                <p>Given the initial state of the velocity field, u<sub>0</sub> = u(x, 0), we can complete the implementation over the time span &Delta;t in four steps.</p>
                <img src="img/implement.png" alt="Snow" style="width:60%" class="center">

                <p>The solution at time <em>t + &Delta;t</em> is given by the velocity at the previous timestep.</p>
                <p>
                <ol style="float: right; margin-right: -2%;">
                    <li><strong>Add Force:</strong></li>
                        <p>Forces are applied at the beginning of each timestep.</p>
                        <img src="img/force.png" alt="Snow" style="width:60%" class="center">
                        <br>
                        <br>
                    <li><strong>Advection/Convection</strong></li>
                        <p>‚ÄúA disturbance somewhere in the fluid propagates according to the expression ‚ÄÇ-(u . ‚àá)u. Therefore, to obtain the velocity at a point X at the new time t + &Delta;t we backtrace the point X through the velocity field  u<sub>1</sub>‚ÄÇover a time &Delta;t. This defines a path p(x, s) corresponding to a partial streamline of the velocity field. The new velocity at the point X is then set to the velocity that the particle, now at X , had at its previous location a -&Delta;t time‚ÄÇago.‚Äù </p>
                        <img src="img/advect.png" alt="Snow" style="width:70%" class="center">
                        <p><font size="2rem">**Note: Interpolate the old value of P from the old values on the grid, when the start point is out of boundary.</font></p>
                        
                    <li><strong>Diffusion</strong></li>                     
                        <p>AX = B, Jacobi iteration technique. The most straightforward way of solving the diffusion equation is to discretize the diffusion operator ‚ÄÇ‚àá<sup>2</sup> and then use the implicit method.</p>
                        <img src="img/diffuse.png" alt="Snow" style="width:30%" class="center">

                    <li><strong>Projection</strong></li>
                        <p>Use the poisson equation to get pressure. subtract pressure gradient from the intermediate velocity field u<sup>3</sup>(x) to get the new divergence free velocity vector field.</p>
                        <img src="img/project.png" alt="Snow" style="width:30%" class="center">
                </ol> 
                </p>
                <p>Link to the GitHub repo can be found <a href="https://github.com/toobarahimnia/Fluid-Simulation.git" target="_blank">here</a>.</p>
                </p>
                
                <p><Strong><font size="5rem"><a id="header15">Result</a></font></strong></p>
                <p>TODO</p>
                <p></p>
                <p></p>
        </div>
        
        
        
         <!-- Footer -->
        <footer class="footer">
<!--             <a class="footer__link" href="" target="_blank" >Curriculum Vitae</a> -->
            <ul class="social-list">
                <li class="social-list__item">
                    <a class="social-list__link" href="https://www.linkedin.com/in/tooba-rahimnia/" target="_blank">
                        <i class="fab fa-linkedin"></i>
                    </a>
                </li>
                <li class="social-list__item">
                    <a class="social-list__link" href="https://github.com/toobarahimnia" target="_blank">
                        <i class="fab fa-github"></i>
                    </a>
                </li>
            </ul>
            <p>Created by Tooba Rahimnia ¬© 2022</p>
        </footer>
        
        
        <script src="js/index.js"></script>
        
    </body>
</html>
